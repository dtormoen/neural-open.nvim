{
  "_comment": "Regression test cases for the scoring pipeline. Changes that break these tests either need a fix, or when scores legitimately change, the update should be isolated in a separate commit scoped to the smallest possible change so it's easy to review what caused the score shift.",
  "test_cases": [
    {
      "context": {
        "alternate_buf": 3,
        "current_file": "/project/lua/mylib/init.lua",
        "cwd": "/project",
        "recent_files": {
          "/project/lua/mylib/config.lua": 3,
          "/project/lua/mylib/utils.lua": 1,
          "/project/tests/init_spec.lua": 2
        },
        "transition_scores": {
          "/project/lua/mylib/config.lua": 0.1,
          "/project/lua/mylib/utils.lua": 0.5
        }
      },
      "items": [
        {
          "buf": 2,
          "expected_normalized_path": "/project/lua/mylib/utils.lua",
          "file": "lua/mylib/utils.lua",
          "frecency": 15
        },
        {
          "buf": 4,
          "expected_normalized_path": "/project/lua/mylib/config.lua",
          "file": "lua/mylib/config.lua",
          "frecency": 5
        },
        {
          "expected_normalized_path": "/project/tests/init_spec.lua",
          "file": "tests/init_spec.lua",
          "frecency": 0
        },
        {
          "expected_normalized_path": "/project/README.md",
          "file": "README.md",
          "frecency": 0
        },
        {
          "expected_normalized_path": "/project/lua/other/helper.lua",
          "file": "lua/other/helper.lua",
          "frecency": 0
        }
      ],
      "name": "Lua workspace with mixed features",
      "phases": [
        {
          "expected_scores": {
            "classic": {
              "/project/README.md": 19.333333,
              "/project/lua/mylib/config.lua": 48.858462,
              "/project/lua/mylib/utils.lua": 55.69222,
              "/project/lua/other/helper.lua": 25.666667,
              "/project/tests/init_spec.lua": 31.721594
            },
            "naive": {
              "/project/README.md": 2.333333,
              "/project/lua/mylib/config.lua": 5.664615,
              "/project/lua/mylib/utils.lua": 6.3627,
              "/project/lua/other/helper.lua": 2.866667,
              "/project/tests/init_spec.lua": 3.671159
            },
            "nn": {
              "/project/README.md": 8.452034,
              "/project/lua/mylib/config.lua": 45.205522,
              "/project/lua/mylib/utils.lua": 62.962374,
              "/project/lua/other/helper.lua": 17.482222,
              "/project/tests/init_spec.lua": 53.229661
            }
          },
          "match_scores": {},
          "name": "initial (empty query)",
          "query": ""
        },
        {
          "expected_scores": {
            "classic": {
              "/project/README.md": 19.333333,
              "/project/lua/mylib/config.lua": 145.454889,
              "/project/lua/mylib/utils.lua": 55.69222,
              "/project/lua/other/helper.lua": 25.666667,
              "/project/tests/init_spec.lua": 31.721594
            },
            "naive": {
              "/project/README.md": 2.333333,
              "/project/lua/mylib/config.lua": 6.35459,
              "/project/lua/mylib/utils.lua": 6.3627,
              "/project/lua/other/helper.lua": 2.866667,
              "/project/tests/init_spec.lua": 3.671159
            },
            "nn": {
              "/project/README.md": 8.452034,
              "/project/lua/mylib/config.lua": 29.126549,
              "/project/lua/mylib/utils.lua": 62.962374,
              "/project/lua/other/helper.lua": 17.482222,
              "/project/tests/init_spec.lua": 53.229661
            }
          },
          "match_scores": {
            "README.md": {
              "match": 0,
              "virtual_name": 0
            },
            "lua/mylib/config.lua": {
              "match": 140,
              "virtual_name": 0
            },
            "lua/mylib/utils.lua": {
              "match": 0,
              "virtual_name": 0
            },
            "lua/other/helper.lua": {
              "match": 0,
              "virtual_name": 0
            },
            "tests/init_spec.lua": {
              "match": 0,
              "virtual_name": 0
            }
          },
          "name": "search for 'conf'",
          "query": "conf"
        }
      ]
    },
    {
      "context": {
        "alternate_buf": 10,
        "current_file": "/app/src/components/Button.tsx",
        "cwd": "/app",
        "recent_files": {
          "/app/src/components/index.tsx": 1,
          "/app/src/utils/index.ts": 3
        },
        "transition_scores": {
          "/app/src/components/index.tsx": 0.8
        }
      },
      "items": [
        {
          "buf": 10,
          "expected_normalized_path": "/app/src/components/index.tsx",
          "file": "src/components/index.tsx",
          "frecency": 20
        },
        {
          "expected_normalized_path": "/app/src/utils/index.ts",
          "file": "src/utils/index.ts",
          "frecency": 3
        },
        {
          "expected_normalized_path": "/app/src/components/Header.tsx",
          "file": "src/components/Header.tsx",
          "frecency": 0
        },
        {
          "expected_normalized_path": "/app/src/App.tsx",
          "file": "src/App.tsx",
          "frecency": 0
        }
      ],
      "name": "TypeScript project with special files and path normalization",
      "phases": [
        {
          "expected_scores": {
            "classic": {
              "/app/src/App.tsx": 26.74359,
              "/app/src/components/Header.tsx": 30.5,
              "/app/src/components/index.tsx": 61.681319,
              "/app/src/utils/index.ts": 38.12303
            },
            "naive": {
              "/app/src/App.tsx": 2.974359,
              "/app/src/components/Header.tsx": 3.25,
              "/app/src/components/index.tsx": 7.668132,
              "/app/src/utils/index.ts": 4.019394
            },
            "nn": {
              "/app/src/App.tsx": 19.26023,
              "/app/src/components/Header.tsx": 26.314265,
              "/app/src/components/index.tsx": 89.708519,
              "/app/src/utils/index.ts": 42.613688
            }
          },
          "match_scores": {},
          "name": "initial (empty query)",
          "query": ""
        },
        {
          "expected_scores": {
            "classic": {
              "/app/src/App.tsx": 26.74359,
              "/app/src/components/Header.tsx": 30.5,
              "/app/src/components/index.tsx": 176.836793,
              "/app/src/utils/index.ts": 146.726754
            },
            "naive": {
              "/app/src/App.tsx": 2.974359,
              "/app/src/components/Header.tsx": 3.25,
              "/app/src/components/index.tsx": 8.51961,
              "/app/src/utils/index.ts": 4.822492
            },
            "nn": {
              "/app/src/App.tsx": 19.26023,
              "/app/src/components/Header.tsx": 26.314265,
              "/app/src/components/index.tsx": 97.228504,
              "/app/src/utils/index.ts": 90.03239
            }
          },
          "match_scores": {
            "src/App.tsx": {
              "match": 0,
              "virtual_name": 0
            },
            "src/components/Header.tsx": {
              "match": 0,
              "virtual_name": 0
            },
            "src/components/index.tsx": {
              "match": 80,
              "virtual_name": 90
            },
            "src/utils/index.ts": {
              "match": 75,
              "virtual_name": 85
            }
          },
          "name": "search for 'idx'",
          "query": "idx"
        }
      ]
    },
    {
      "context": {
        "alternate_buf": -1,
        "current_file": "/project/src/main.lua",
        "cwd": "/project/",
        "recent_files": {
          "/project/src/lib.lua": 2
        },
        "transition_scores": {
          "/project/src/lib.lua": 0.3
        }
      },
      "items": [
        {
          "expected_normalized_path": "/project/src/lib.lua",
          "file": "src/lib.lua",
          "frecency": 8
        },
        {
          "expected_normalized_path": "/project/src/main.lua",
          "file": "src/main.lua",
          "frecency": 0
        }
      ],
      "name": "Path normalization edge case with trailing slash",
      "phases": [
        {
          "expected_scores": {
            "classic": {
              "/project/src/lib.lua": 50.546364,
              "/project/src/main.lua": 33
            },
            "naive": {
              "/project/src/lib.lua": 5.153636,
              "/project/src/main.lua": 3
            },
            "nn": {
              "/project/src/lib.lua": 70.567337,
              "/project/src/main.lua": 9.386067
            }
          },
          "match_scores": {},
          "name": "initial (empty query)",
          "query": ""
        }
      ]
    },
    {
      "context": {
        "alternate_buf": -1,
        "current_file": "/home/user/dotfiles/Makefile",
        "cwd": "/home/user/dotfiles",
        "recent_files": {
          "/home/user/dotfiles/.gitignore": 1,
          "/home/user/dotfiles/scripts/setup": 3
        },
        "transition_scores": {
          "/home/user/dotfiles/Dockerfile": 0.4
        }
      },
      "items": [
        {
          "expected_normalized_path": "/home/user/dotfiles/Makefile",
          "file": "Makefile",
          "frecency": 10
        },
        {
          "expected_normalized_path": "/home/user/dotfiles/Dockerfile",
          "file": "Dockerfile",
          "frecency": 0
        },
        {
          "expected_normalized_path": "/home/user/dotfiles/LICENSE",
          "file": "LICENSE",
          "frecency": 0
        },
        {
          "buf": 5,
          "expected_normalized_path": "/home/user/dotfiles/.gitignore",
          "file": ".gitignore",
          "frecency": 3
        },
        {
          "expected_normalized_path": "/home/user/dotfiles/scripts/setup",
          "file": "scripts/setup",
          "frecency": 0
        },
        {
          "expected_normalized_path": "/home/user/dotfiles/.config/nvim/init.lua",
          "file": ".config/nvim/init.lua",
          "frecency": 7
        }
      ],
      "name": "Home directory with extensionless and dotfiles",
      "phases": [
        {
          "expected_scores": {
            "classic": {
              "/home/user/dotfiles/.config/nvim/init.lua": 30.733333,
              "/home/user/dotfiles/.gitignore": 44.636364,
              "/home/user/dotfiles/Dockerfile": 32.857143,
              "/home/user/dotfiles/LICENSE": 28,
              "/home/user/dotfiles/Makefile": 42.444444,
              "/home/user/dotfiles/scripts/setup": 33.57
            },
            "naive": {
              "/home/user/dotfiles/.config/nvim/init.lua": 3.066667,
              "/home/user/dotfiles/.gitignore": 5.272727,
              "/home/user/dotfiles/Dockerfile": 3.685714,
              "/home/user/dotfiles/LICENSE": 3,
              "/home/user/dotfiles/Makefile": 3.555556,
              "/home/user/dotfiles/scripts/setup": 3.73
            },
            "nn": {
              "/home/user/dotfiles/.config/nvim/init.lua": 27.487417,
              "/home/user/dotfiles/.gitignore": 8.30875,
              "/home/user/dotfiles/Dockerfile": 40.060876,
              "/home/user/dotfiles/LICENSE": 25.690533,
              "/home/user/dotfiles/Makefile": 25.758208,
              "/home/user/dotfiles/scripts/setup": 20.645856
            }
          },
          "match_scores": {},
          "name": "initial (empty query)",
          "query": ""
        },
        {
          "expected_scores": {
            "classic": {
              "/home/user/dotfiles/.config/nvim/init.lua": 30.733333,
              "/home/user/dotfiles/.gitignore": 44.636364,
              "/home/user/dotfiles/Dockerfile": 32.857143,
              "/home/user/dotfiles/LICENSE": 28,
              "/home/user/dotfiles/Makefile": 171.175085,
              "/home/user/dotfiles/scripts/setup": 33.57
            },
            "naive": {
              "/home/user/dotfiles/.config/nvim/init.lua": 3.066667,
              "/home/user/dotfiles/.gitignore": 5.272727,
              "/home/user/dotfiles/Dockerfile": 3.685714,
              "/home/user/dotfiles/LICENSE": 3,
              "/home/user/dotfiles/Makefile": 4.505597,
              "/home/user/dotfiles/scripts/setup": 3.73
            },
            "nn": {
              "/home/user/dotfiles/.config/nvim/init.lua": 27.487417,
              "/home/user/dotfiles/.gitignore": 8.30875,
              "/home/user/dotfiles/Dockerfile": 40.060876,
              "/home/user/dotfiles/LICENSE": 25.690533,
              "/home/user/dotfiles/Makefile": 50.453454,
              "/home/user/dotfiles/scripts/setup": 20.645856
            }
          },
          "match_scores": {
            ".config/nvim/init.lua": {
              "match": 0,
              "virtual_name": 0
            },
            ".gitignore": {
              "match": 0,
              "virtual_name": 0
            },
            "Dockerfile": {
              "match": 0,
              "virtual_name": 0
            },
            "LICENSE": {
              "match": 0,
              "virtual_name": 0
            },
            "Makefile": {
              "match": 95,
              "virtual_name": 0
            },
            "scripts/setup": {
              "match": 0,
              "virtual_name": 0
            }
          },
          "name": "search for 'make'",
          "query": "make"
        }
      ]
    },
    {
      "context": {
        "alternate_buf": -1,
        "current_file": "/home/user/my project/src/app (main).lua",
        "cwd": "/home/user/my project",
        "recent_files": {
          "/home/user/my project/.github/workflows/ci.yml": 2,
          "/home/user/my project/src/utils [v2].lua": 1
        },
        "transition_scores": {
          "/home/user/my project/src/utils [v2].lua": 0.6
        }
      },
      "items": [
        {
          "buf": 7,
          "expected_normalized_path": "/home/user/my project/src/utils [v2].lua",
          "file": "src/utils [v2].lua",
          "frecency": 12
        },
        {
          "expected_normalized_path": "/home/user/my project/.github/workflows/ci.yml",
          "file": ".github/workflows/ci.yml",
          "frecency": 0
        },
        {
          "expected_normalized_path": "/home/user/my project/src/app (main).lua",
          "file": "src/app (main).lua",
          "frecency": 5
        },
        {
          "expected_normalized_path": "/home/user/my project/docs/r\u00e9sum\u00e9.md",
          "file": "docs/r\u00e9sum\u00e9.md",
          "frecency": 0
        },
        {
          "expected_normalized_path": "/home/user/my project/src/a-b_c.d.lua",
          "file": "src/a-b_c.d.lua",
          "frecency": 0
        }
      ],
      "name": "Paths with spaces, brackets, parens, unicode, and special chars",
      "phases": [
        {
          "expected_scores": {
            "classic": {
              "/home/user/my project/.github/workflows/ci.yml": 31.71,
              "/home/user/my project/docs/r\u00e9sum\u00e9.md": 24.75,
              "/home/user/my project/src/a-b_c.d.lua": 29.904762,
              "/home/user/my project/src/app (main).lua": 39.538462,
              "/home/user/my project/src/utils [v2].lua": 54.866667
            },
            "naive": {
              "/home/user/my project/.github/workflows/ci.yml": 3.59,
              "/home/user/my project/docs/r\u00e9sum\u00e9.md": 2.75,
              "/home/user/my project/src/a-b_c.d.lua": 3.190476,
              "/home/user/my project/src/app (main).lua": 3.384615,
              "/home/user/my project/src/utils [v2].lua": 6.366667
            },
            "nn": {
              "/home/user/my project/.github/workflows/ci.yml": 18.758206,
              "/home/user/my project/docs/r\u00e9sum\u00e9.md": 17.9818,
              "/home/user/my project/src/a-b_c.d.lua": 26.129051,
              "/home/user/my project/src/app (main).lua": 14.563129,
              "/home/user/my project/src/utils [v2].lua": 62.953287
            }
          },
          "match_scores": {},
          "name": "initial (empty query)",
          "query": ""
        },
        {
          "expected_scores": {
            "classic": {
              "/home/user/my project/.github/workflows/ci.yml": 31.71,
              "/home/user/my project/docs/r\u00e9sum\u00e9.md": 24.75,
              "/home/user/my project/src/a-b_c.d.lua": 29.904762,
              "/home/user/my project/src/app (main).lua": 82.942034,
              "/home/user/my project/src/utils [v2].lua": 131.843426
            },
            "naive": {
              "/home/user/my project/.github/workflows/ci.yml": 3.59,
              "/home/user/my project/docs/r\u00e9sum\u00e9.md": 2.75,
              "/home/user/my project/src/a-b_c.d.lua": 3.190476,
              "/home/user/my project/src/app (main).lua": 3.694641,
              "/home/user/my project/src/utils [v2].lua": 6.916501
            },
            "nn": {
              "/home/user/my project/.github/workflows/ci.yml": 18.758206,
              "/home/user/my project/docs/r\u00e9sum\u00e9.md": 17.9818,
              "/home/user/my project/src/a-b_c.d.lua": 26.129051,
              "/home/user/my project/src/app (main).lua": 5.420229,
              "/home/user/my project/src/utils [v2].lua": 30.706138
            }
          },
          "match_scores": {
            ".github/workflows/ci.yml": {
              "match": 0,
              "virtual_name": 0
            },
            "docs/r\u00e9sum\u00e9.md": {
              "match": 0,
              "virtual_name": 0
            },
            "src/a-b_c.d.lua": {
              "match": 0,
              "virtual_name": 0
            },
            "src/app (main).lua": {
              "match": 60,
              "virtual_name": 0
            },
            "src/utils [v2].lua": {
              "match": 110,
              "virtual_name": 0
            }
          },
          "name": "search for 'util'",
          "query": "util"
        }
      ]
    }
  ],
  "tolerance": 0.001
}
